n- name: Run tests with coverage
  run: |
    mkdir -p TestResults/coverage

    echo "ğŸ§ª Searching for test projects..."
    find . -name "*.Tests.csproj"

    for proj in $(find . -name "*.Tests.csproj"); do
      echo "â¡ï¸ Running tests for $proj"
      dotnet test "$proj" \
        --no-build \
        --configuration Release \
        --collect:"XPlat Code Coverage" \
        --results-directory ./TestResults/coverage
    done

    echo "ğŸ” Checking for coverage file..."
    find ./TestResults -name "coverage.cobertura.xml" || true

    if [ ! -f ./TestResults/coverage/*/coverage.cobertura.xml ]; then
      echo "âŒ coverage.cobertura.xml NOT FOUND!"
      exit 1
    else
      echo "âœ… coverage.cobertura.xml FOUND!"
    fi
